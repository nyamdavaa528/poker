<!DOCTYPE html>
<html lang="mn">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, viewport-fit=cover"
    />
    <title>Poker Table Ledger</title>

    <style>
      :root {
        --bg: #0b0f14;
        --text: rgba(255, 255, 255, 0.92);
        --muted: rgba(255, 255, 255, 0.65);
        --line: rgba(255, 255, 255, 0.1);

        --green: #33d17a;
        --yellow: #f6d32d;
        --red: #ff4d4d;
        --blue: #62a0ea;

        --shadow: 0 10px 30px rgba(0, 0, 0, 0.35);
        --r: 18px;
      }

      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto,
          Arial;
        background: radial-gradient(
            1200px 600px at 50% -20%,
            rgba(98, 160, 234, 0.25),
            transparent 55%
          ),
          radial-gradient(
            900px 500px at 10% 10%,
            rgba(51, 209, 122, 0.2),
            transparent 55%
          ),
          var(--bg);
        color: var(--text);
      }

      .wrap {
        max-width: 980px;
        margin: 0 auto;
        padding: 16px 14px 150px;
      }

      .topbar {
        display: flex;
        align-items: flex-start;
        justify-content: space-between;
        gap: 10px;
        margin-bottom: 14px;
      }
      .brand {
        display: flex;
        flex-direction: column;
        gap: 2px;
      }
      .brand h1 {
        margin: 0;
        font-size: 18px;
        letter-spacing: 0.2px;
      }
      .brand .sub {
        font-size: 12px;
        color: var(--muted);
      }

      .pills {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
        justify-content: flex-end;
      }
      .pill {
        padding: 6px 10px;
        font-size: 12px;
        border: 1px solid var(--line);
        background: rgba(255, 255, 255, 0.04);
        border-radius: 999px;
        color: var(--muted);
        white-space: nowrap;
      }
      .pill strong {
        color: var(--text);
        font-weight: 800;
      }

      .card {
        background: linear-gradient(
          180deg,
          rgba(255, 255, 255, 0.08),
          rgba(255, 255, 255, 0.05)
        );
        border: 1px solid var(--line);
        border-radius: var(--r);
        padding: 14px;
        box-shadow: var(--shadow);
        backdrop-filter: blur(10px);
      }

      .grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 12px;
      }
      @media (min-width: 860px) {
        .grid {
          grid-template-columns: 1.15fr 0.85fr;
        }
      }

      .row {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        align-items: center;
      }
      input {
        width: 100%;
        background: rgba(255, 255, 255, 0.06);
        border: 1px solid var(--line);
        color: var(--text);
        border-radius: 14px;
        padding: 12px;
        font-size: 14px;
        outline: none;
      }
      input::placeholder {
        color: rgba(255, 255, 255, 0.45);
      }

      button {
        border: 1px solid var(--line);
        background: rgba(255, 255, 255, 0.06);
        color: var(--text);
        padding: 12px 12px;
        border-radius: 14px;
        font-weight: 900;
        font-size: 14px;
        cursor: pointer;
        transition: transform 0.06s ease, opacity 0.12s ease;
        user-select: none;
        -webkit-tap-highlight-color: transparent;
      }
      button:active {
        transform: scale(0.98);
      }
      button:disabled {
        opacity: 0.45;
        cursor: not-allowed;
      }

      .btn-green {
        background: rgba(51, 209, 122, 0.14);
        border-color: rgba(51, 209, 122, 0.35);
      }
      .btn-yellow {
        background: rgba(246, 211, 45, 0.12);
        border-color: rgba(246, 211, 45, 0.35);
      }
      .btn-red {
        background: rgba(255, 77, 77, 0.12);
        border-color: rgba(255, 77, 77, 0.35);
      }
      .btn-blue {
        background: rgba(98, 160, 234, 0.12);
        border-color: rgba(98, 160, 234, 0.35);
      }

      .muted {
        color: var(--muted);
        font-size: 12px;
        line-height: 1.35;
      }
      .divider {
        height: 1px;
        background: var(--line);
        margin: 12px 0;
      }

      /* Lobby: show ONLY occupied players */
      .seatList {
        display: grid;
        grid-template-columns: repeat(2, minmax(0, 1fr));
        gap: 10px;
      }
      @media (min-width: 520px) {
        .seatList {
          grid-template-columns: repeat(3, minmax(0, 1fr));
        }
      }
      @media (min-width: 860px) {
        .seatList {
          grid-template-columns: repeat(5, minmax(0, 1fr));
        }
      }

      .seatMini {
        border: 1px solid var(--line);
        background: rgba(255, 255, 255, 0.04);
        border-radius: 14px;
        padding: 10px;
        min-height: 56px;
      }
      .seatMini .n {
        font-weight: 900;
        font-size: 13px;
      }
      .seatMini .s {
        font-size: 12px;
        color: var(--muted);
        margin-top: 2px;
      }

      .tag {
        display: inline-block;
        padding: 2px 8px;
        border-radius: 999px;
        font-size: 11px;
        border: 1px solid var(--line);
        color: var(--muted);
        margin-left: 6px;
      }
      .tag.ready {
        border-color: rgba(51, 209, 122, 0.35);
        color: rgba(51, 209, 122, 0.95);
        background: rgba(51, 209, 122, 0.1);
      }
      .tag.host {
        border-color: rgba(98, 160, 234, 0.35);
        color: rgba(98, 160, 234, 0.95);
        background: rgba(98, 160, 234, 0.1);
      }

      /* --- TABLE --- */
      .tableWrap {
        position: relative;
        width: 100%;
        aspect-ratio: 16/11;
        max-height: 72vh;
        border-radius: 26px;
        border: 1px solid var(--line);
        background: radial-gradient(
            700px 300px at 50% 35%,
            rgba(51, 209, 122, 0.25),
            transparent 60%
          ),
          radial-gradient(
            900px 450px at 50% 70%,
            rgba(0, 0, 0, 0.3),
            transparent 60%
          ),
          rgba(255, 255, 255, 0.03);
        box-shadow: var(--shadow);
        overflow: hidden;
      }
      .felt {
        position: absolute;
        inset: 18px;
        border-radius: 999px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        background: radial-gradient(
            700px 300px at 50% 40%,
            rgba(51, 209, 122, 0.35),
            rgba(51, 209, 122, 0.12) 45%,
            rgba(0, 0, 0, 0.16) 70%
          ),
          rgba(0, 0, 0, 0.18);
      }

      .centerInfo {
        position: absolute;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
        text-align: center;
        padding: 10px 12px;
        border-radius: 16px;
        border: 1px solid rgba(255, 255, 255, 0.12);
        background: rgba(0, 0, 0, 0.22);
        min-width: 220px;
      }
      .centerInfo .pot {
        font-size: 18px;
        font-weight: 950;
      }
      .centerInfo .meta {
        margin-top: 4px;
        font-size: 12px;
        color: var(--muted);
        line-height: 1.35;
      }

      .turnBanner {
        margin-top: 10px;
        padding: 10px 12px;
        border-radius: 16px;
        border: 1px solid rgba(51, 209, 122, 0.3);
        background: rgba(51, 209, 122, 0.1);
        font-weight: 950;
      }

      /* Seats: rendered dynamically (only occupied) */
      #seatLayer {
        position: absolute;
        inset: 0;
      }

      .seat {
        position: absolute;
        width: min(220px, 44%);
        min-width: 140px;
        border-radius: 16px;
        border: 1px solid var(--line);
        background: rgba(0, 0, 0, 0.26);
        padding: 10px 10px;
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.25);
        transform: translate(-50%, -50%);
      }

      @media (max-width: 420px) {
        .seat {
          width: 48%;
          min-width: 132px;
          padding: 9px 9px;
        }
      }

      .seat.me {
        border-color: rgba(98, 160, 234, 0.45);
        background: rgba(98, 160, 234, 0.12);
      }
      .seat.turn {
        border-color: rgba(51, 209, 122, 0.85);
        box-shadow: 0 0 0 3px rgba(51, 209, 122, 0.22),
          0 0 28px rgba(51, 209, 122, 0.18), 0 18px 30px rgba(0, 0, 0, 0.28);
        background: rgba(51, 209, 122, 0.14);
      }
      .seat.folded {
        opacity: 0.45;
      }

      .seat .name {
        font-weight: 950;
        font-size: 13px;
        display: flex;
        align-items: center;
        gap: 8px;
        flex-wrap: wrap;
        line-height: 1.15;
      }
      .seat .betLine {
        margin-top: 6px;
        display: flex;
        justify-content: space-between;
        font-size: 12px;
        color: rgba(255, 255, 255, 0.85);
      }
      .seat .betLine .mut {
        color: var(--muted);
      }

      .badge {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 22px;
        height: 22px;
        border-radius: 999px;
        border: 1px solid rgba(255, 255, 255, 0.14);
        background: rgba(255, 255, 255, 0.06);
        font-size: 11px;
        color: var(--text);
        flex: 0 0 auto;
      }
      .badge.dealer {
        border-color: rgba(246, 211, 45, 0.4);
        background: rgba(246, 211, 45, 0.12);
      }
      .badge.turn {
        border-color: rgba(51, 209, 122, 0.45);
        background: rgba(51, 209, 122, 0.12);
      }

      .bottomBar {
        position: fixed;
        left: 0;
        right: 0;
        bottom: 0;
        padding: 10px 12px calc(10px + env(safe-area-inset-bottom));
        background: rgba(0, 0, 0, 0.55);
        border-top: 1px solid rgba(255, 255, 255, 0.12);
        backdrop-filter: blur(12px);
      }
      .bottomInner {
        max-width: 980px;
        margin: 0 auto;
        display: flex;
        gap: 10px;
        align-items: center;
        flex-wrap: wrap;
      }
      .raiseBox {
        display: flex;
        gap: 10px;
        align-items: center;
        width: 100%;
      }
      .raiseBox input {
        flex: 1 1 auto;
      }
      .hide {
        display: none !important;
      }

      .error {
        white-space: pre-wrap;
        margin-top: 10px;
        padding: 10px 12px;
        border-radius: 14px;
        border: 1px solid rgba(255, 77, 77, 0.35);
        background: rgba(255, 77, 77, 0.1);
        color: rgba(255, 255, 255, 0.92);
        font-weight: 850;
      }
    </style>
  </head>

  <body>
    <div class="wrap">
      <div class="topbar">
        <div class="brand">
          <h1>Poker Table Ledger</h1>
          <div class="sub">
            Жинхэнэ хөзөр — зөвхөн мөнгөний тооцоо (call / raise / fold)
          </div>
        </div>
        <div class="pills">
          <span class="pill" id="pillTable"><strong>Table:</strong> -</span>
          <span class="pill" id="pillRole"><strong>Role:</strong> -</span>
        </div>
      </div>

      <!-- ENTRY -->
      <div class="card" id="screenEntry">
        <div class="row">
          <input
            id="tableId"
            placeholder="Table ID (ж: table-1)"
            autocomplete="off"
          />
          <input id="name" placeholder="Таны нэр" autocomplete="off" />
        </div>
        <div class="row" style="margin-top: 10px">
          <button id="createBtn" class="btn-blue" style="flex: 1 1 200px">
            Table үүсгэх (Host)
          </button>
          <button id="joinBtn" style="flex: 1 1 120px">Орох</button>
        </div>
        <div class="muted" style="margin-top: 10px">
          Нэг нь Table үүсгэнэ. Бусад нь ижил Table ID-гаар орно.
        </div>
        <div id="entryErr" class="error hide"></div>
      </div>

      <!-- LOBBY -->
      <div class="card hide" id="screenLobby">
        <div class="row">
          <button id="readyBtn" class="btn-green" style="flex: 1 1 120px">
            Ready
          </button>
          <button id="lobbySettleBtn" class="btn-blue" style="flex: 1 1 140px">
            Settlement
          </button>
          <button id="leaveBtn" style="flex: 1 1 90px">Гарах</button>
        </div>

        <div class="divider"></div>

        <div class="row" style="justify-content: space-between">
          <div class="muted">Бүгд Ready → Host Start.</div>
          <button id="startBtn" class="btn-yellow hide" style="flex: 0 0 auto">
            Start
          </button>
        </div>

        <div class="divider"></div>
        <div class="seatList" id="lobbySeats"></div>

        <div id="lobbyErr" class="error hide"></div>
      </div>

      <!-- GAME -->
      <div class="grid hide" id="screenGameGrid">
        <div class="card">
          <div class="tableWrap">
            <div class="felt"></div>

            <div class="centerInfo">
              <div class="pot" id="potText">Current: 0</div>
              <div class="meta" id="handMeta"></div>
            </div>

            <div id="seatLayer"></div>
          </div>

          <div id="turnBanner" class="turnBanner hide"></div>
          <div id="gameErr" class="error hide"></div>
        </div>

        <div class="card">
          <div class="row" style="justify-content: space-between">
            <div>
              <div style="font-weight: 950">Ledger</div>
              <div class="muted">+ авах, − төлөх (нийт)</div>
            </div>
            <button id="settleBtn" class="btn-blue" style="flex: 0 0 auto">
              Settlement
            </button>
          </div>

          <div class="divider"></div>
          <div id="ledgerList"></div>

          <div class="divider"></div>
          <div style="font-weight: 950">History</div>
          <div
            id="history"
            class="muted"
            style="margin-top: 8px; font-size: 12px"
          ></div>

          <div class="divider"></div>
          <button id="backToLobbyBtn">Lobby руу буцах</button>
          <div class="muted" style="margin-top: 8px">
            Гар дууссан үед бүгд Ready → Host Start.
          </div>
        </div>
      </div>
    </div>

    <!-- Bottom action bar (game only) -->
    <div class="bottomBar hide" id="bottomBar">
      <div class="bottomInner">
        <div id="actionStatus" class="pill" style="flex: 1 1 220px">
          Waiting…
        </div>

        <button class="btn-green" id="btnCall" style="flex: 1 1 120px">
          Call
        </button>

        <div class="raiseBox" style="flex: 2 1 240px">
          <input
            id="raiseInput"
            inputmode="numeric"
            placeholder="Raise to (ж: 1,000)"
          />
          <button class="btn-yellow" id="btnRaise" style="flex: 0 0 auto">
            Raise
          </button>
        </div>

        <div class="raiseBox" style="flex: 2 1 260px">
          <button id="q500" class="btn-yellow" style="flex: 1 1 70px">
            500
          </button>
          <button id="q1000" class="btn-yellow" style="flex: 1 1 80px">
            1,000
          </button>
          <button id="q1500" class="btn-yellow" style="flex: 1 1 80px">
            1,500
          </button>
          <button id="q2000" class="btn-yellow" style="flex: 1 1 80px">
            2,000
          </button>
        </div>

        <button class="btn-red" id="btnFold" style="flex: 1 1 110px">
          Fold
        </button>
        <button class="btn-blue hide" id="btnWin" style="flex: 1 1 150px">
          Winner (Host)
        </button>
      </div>
    </div>

    <script src="./config.js"></script>
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
    <script src="./app.js"></script>
  </body>
</html>
