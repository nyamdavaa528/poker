<!DOCTYPE html>
<html lang="mn">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, viewport-fit=cover"
    />
    <title>Poker Table Ledger</title>

    <style>
      :root {
        --bg: #0b0f14;
        --text: rgba(255, 255, 255, 0.92);
        --muted: rgba(255, 255, 255, 0.65);
        --line: rgba(255, 255, 255, 0.1);

        --green: #33d17a;
        --yellow: #f6d32d;
        --red: #ff4d4d;
        --blue: #62a0ea;

        --shadow: 0 10px 30px rgba(0, 0, 0, 0.35);
        --r: 18px;
      }

      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto,
          Arial;
        background: radial-gradient(
            1200px 600px at 50% -20%,
            rgba(98, 160, 234, 0.25),
            transparent 55%
          ),
          radial-gradient(
            900px 500px at 10% 10%,
            rgba(51, 209, 122, 0.2),
            transparent 55%
          ),
          var(--bg);
        color: var(--text);
      }

      /* Mobile-first layout */
      .wrap {
        max-width: 980px;
        margin: 0 auto;
        padding: 14px 12px 150px;
      }

      .topbar {
        display: flex;
        align-items: flex-start;
        justify-content: space-between;
        gap: 10px;
        margin-bottom: 12px;
      }

      .brand h1 {
        margin: 0;
        font-size: 16px;
        letter-spacing: 0.2px;
      }
      .brand .sub {
        margin-top: 2px;
        font-size: 12px;
        color: var(--muted);
        line-height: 1.3;
      }

      .pills {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
        justify-content: flex-end;
      }
      .pill {
        padding: 6px 10px;
        font-size: 12px;
        border: 1px solid var(--line);
        background: rgba(255, 255, 255, 0.04);
        border-radius: 999px;
        color: var(--muted);
        white-space: nowrap;
      }

      .card {
        background: linear-gradient(
          180deg,
          rgba(255, 255, 255, 0.08),
          rgba(255, 255, 255, 0.05)
        );
        border: 1px solid var(--line);
        border-radius: var(--r);
        padding: 12px;
        box-shadow: var(--shadow);
        backdrop-filter: blur(10px);
      }

      .row {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        align-items: center;
      }

      input {
        width: 100%;
        background: rgba(255, 255, 255, 0.06);
        border: 1px solid var(--line);
        color: var(--text);
        border-radius: 14px;
        padding: 12px;
        font-size: 14px;
        outline: none;
      }

      button {
        border: 1px solid var(--line);
        background: rgba(255, 255, 255, 0.06);
        color: var(--text);
        padding: 12px 12px;
        border-radius: 14px;
        font-weight: 900;
        font-size: 14px;
        cursor: pointer;
        transition: transform 0.06s ease, opacity 0.12s ease;
        user-select: none;
        -webkit-tap-highlight-color: transparent;
      }
      button:active {
        transform: scale(0.98);
      }
      button:disabled {
        opacity: 0.45;
        cursor: not-allowed;
      }

      .btn-green {
        background: rgba(51, 209, 122, 0.14);
        border-color: rgba(51, 209, 122, 0.35);
      }
      .btn-yellow {
        background: rgba(246, 211, 45, 0.12);
        border-color: rgba(246, 211, 45, 0.35);
      }
      .btn-red {
        background: rgba(255, 77, 77, 0.12);
        border-color: rgba(255, 77, 77, 0.35);
      }
      .btn-blue {
        background: rgba(98, 160, 234, 0.12);
        border-color: rgba(98, 160, 234, 0.35);
      }

      .muted {
        color: var(--muted);
        font-size: 12px;
        line-height: 1.35;
      }
      .divider {
        height: 1px;
        background: var(--line);
        margin: 12px 0;
      }

      /* Lobby: only occupied */
      .seatList {
        display: grid;
        grid-template-columns: repeat(2, minmax(0, 1fr));
        gap: 10px;
      }
      @media (min-width: 520px) {
        .seatList {
          grid-template-columns: repeat(3, minmax(0, 1fr));
        }
      }

      .seatMini {
        border: 1px solid var(--line);
        background: rgba(255, 255, 255, 0.04);
        border-radius: 14px;
        padding: 10px;
        min-height: 56px;
      }
      .seatMini .n {
        font-weight: 900;
        font-size: 13px;
      }
      .seatMini .s {
        font-size: 12px;
        color: var(--muted);
        margin-top: 2px;
      }

      .tag {
        display: inline-block;
        padding: 2px 8px;
        border-radius: 999px;
        font-size: 11px;
        border: 1px solid var(--line);
        color: var(--muted);
        margin-left: 6px;
      }
      .tag.ready {
        border-color: rgba(51, 209, 122, 0.35);
        color: rgba(51, 209, 122, 0.95);
        background: rgba(51, 209, 122, 0.1);
      }
      .tag.host {
        border-color: rgba(98, 160, 234, 0.35);
        color: rgba(98, 160, 234, 0.95);
        background: rgba(98, 160, 234, 0.1);
      }

      /* --- TABLE: portrait (vertical) --- */
      .tableWrap {
        position: relative;
        width: 100%;
        aspect-ratio: 10/16; /* portrait */
        max-height: 74vh;
        border-radius: 26px;
        border: 1px solid var(--line);
        background: radial-gradient(
            700px 300px at 50% 30%,
            rgba(51, 209, 122, 0.2),
            transparent 60%
          ),
          radial-gradient(
            900px 450px at 50% 72%,
            rgba(0, 0, 0, 0.35),
            transparent 60%
          ),
          rgba(255, 255, 255, 0.03);
        box-shadow: var(--shadow);
        overflow: hidden;
      }

      .felt {
        position: absolute;
        inset: 16px;
        border-radius: 999px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        background: radial-gradient(
            700px 300px at 50% 40%,
            rgba(51, 209, 122, 0.32),
            rgba(51, 209, 122, 0.1) 45%,
            rgba(0, 0, 0, 0.18) 70%
          ),
          rgba(0, 0, 0, 0.18);
      }

      .centerInfo {
        position: absolute;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
        text-align: center;
        padding: 10px 12px;
        border-radius: 16px;
        border: 1px solid rgba(255, 255, 255, 0.12);
        background: rgba(0, 0, 0, 0.22);
        min-width: 210px;
      }
      .centerInfo .pot {
        font-size: 18px;
        font-weight: 950;
      }
      .centerInfo .meta {
        margin-top: 4px;
        font-size: 12px;
        color: var(--muted);
        line-height: 1.35;
      }

      .turnBanner {
        margin-top: 10px;
        padding: 10px 12px;
        border-radius: 16px;
        border: 1px solid rgba(255, 77, 77, 0.32);
        background: rgba(255, 77, 77, 0.1);
        font-weight: 950;
      }

      /* Seat styling */
      #seatLayer {
        position: absolute;
        inset: 0;
      }

      .seat {
        position: absolute;
        width: 46%;
        max-width: 178px;
        min-width: 108px;
        border-radius: 16px;
        border: 1px solid var(--line);
        background: rgba(0, 0, 0, 0.26);
        padding: 8px 10px;
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.25);
        transform: translate(-50%, -50%);
        overflow: hidden;
      }

      /* Make text always visible */
      .seat .name {
        font-weight: 950;
        font-size: 13px;
        display: flex;
        align-items: center;
        gap: 8px;
        flex-wrap: wrap;
        line-height: 1.15;
        overflow-wrap: anywhere;
        word-break: break-word;
      }

      .seat .betLine {
        margin-top: 6px;
        display: flex;
        justify-content: space-between;
        font-size: 12px;
        color: rgba(255, 255, 255, 0.88);
      }
      .seat .betLine .mut {
        color: var(--muted);
      }

      .seat.me {
        border-color: rgba(98, 160, 234, 0.45);
        background: rgba(98, 160, 234, 0.12);
      }

      /* TURN = RED glow */
      .seat.turn {
        border-color: rgba(255, 77, 77, 0.9);
        box-shadow: 0 0 0 3px rgba(255, 77, 77, 0.22),
          0 0 28px rgba(255, 77, 77, 0.18), 0 18px 30px rgba(0, 0, 0, 0.28);
        background: rgba(255, 77, 77, 0.1);
      }

      .seat.folded {
        opacity: 0.45;
      }

      .badge {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 22px;
        height: 22px;
        border-radius: 999px;
        border: 1px solid rgba(255, 255, 255, 0.14);
        background: rgba(255, 255, 255, 0.06);
        font-size: 11px;
        color: var(--text);
        flex: 0 0 auto;
      }
      .badge.dealer {
        border-color: rgba(246, 211, 45, 0.4);
        background: rgba(246, 211, 45, 0.12);
      }
      .badge.turn {
        border-color: rgba(255, 77, 77, 0.55);
        background: rgba(255, 77, 77, 0.16);
      }

      /* Portrait seat positions (10) - safe within screen */
      .p0 {
        left: 50%;
        top: 7%;
      }
      .p1 {
        left: 78%;
        top: 15%;
      }
      .p2 {
        left: 90%;
        top: 29%;
      }
      .p3 {
        left: 90%;
        top: 47%;
      }
      .p4 {
        left: 78%;
        top: 63%;
      }
      .p5 {
        left: 50%;
        top: 77%;
      }
      .p6 {
        left: 22%;
        top: 63%;
      }
      .p7 {
        left: 10%;
        top: 47%;
      }
      .p8 {
        left: 10%;
        top: 29%;
      }
      .p9 {
        left: 22%;
        top: 15%;
      }

      /* Bottom action bar: mobile-friendly */
      .bottomBar {
        position: fixed;
        left: 0;
        right: 0;
        bottom: 0;
        padding: 10px 12px calc(12px + env(safe-area-inset-bottom));
        background: rgba(0, 0, 0, 0.62);
        border-top: 1px solid rgba(255, 255, 255, 0.12);
        backdrop-filter: blur(12px);
      }
      .bottomInner {
        max-width: 980px;
        margin: 0 auto;
        display: grid;
        grid-template-columns: 1fr;
        gap: 10px;
      }

      .actionRow {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        gap: 10px;
      }

      .raiseRow {
        display: grid;
        grid-template-columns: 1fr auto;
        gap: 10px;
        align-items: center;
      }

      .quickRow {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 8px;
      }

      /* Make tap targets bigger */
      .bottomBar button {
        padding: 14px 12px;
        border-radius: 16px;
        font-size: 16px;
      }
      .bottomBar input {
        padding: 14px 12px;
        border-radius: 16px;
        font-size: 16px;
      }

      /* When it's YOUR turn: make buttons bigger + more contrast */
      .bottomBar.myTurn button {
        padding: 18px 12px;
        font-size: 18px;
        border-width: 2px;
      }
      .bottomBar.myTurn #btnCall {
        background: rgba(51, 209, 122, 0.22);
        border-color: rgba(51, 209, 122, 0.55);
      }
      .bottomBar.myTurn #btnRaise {
        background: rgba(246, 211, 45, 0.18);
        border-color: rgba(246, 211, 45, 0.55);
      }
      .bottomBar.myTurn #btnFold {
        background: rgba(255, 77, 77, 0.18);
        border-color: rgba(255, 77, 77, 0.55);
      }

      .hide {
        display: none !important;
      }

      .error {
        white-space: pre-wrap;
        margin-top: 10px;
        padding: 10px 12px;
        border-radius: 14px;
        border: 1px solid rgba(255, 77, 77, 0.35);
        background: rgba(255, 77, 77, 0.1);
        color: rgba(255, 255, 255, 0.92);
        font-weight: 850;
      }

      details {
        margin-top: 12px;
        border: 1px solid var(--line);
        border-radius: 14px;
        background: rgba(255, 255, 255, 0.03);
        overflow: hidden;
      }
      summary {
        cursor: pointer;
        padding: 12px;
        font-weight: 950;
        list-style: none;
      }
      summary::-webkit-details-marker {
        display: none;
      }
      .detailsBody {
        padding: 0 12px 12px 12px;
      }
    </style>
  </head>

  <body>
    <div class="wrap">
      <div class="topbar">
        <div class="brand">
          <h1>Poker Table Ledger</h1>
          <div class="sub">Утсанд зориулсан — ширээ + call/raise/fold</div>
        </div>
        <div class="pills">
          <span class="pill" id="pillTable">Table: -</span>
          <span class="pill" id="pillRole">Role: -</span>
        </div>
      </div>

      <!-- ENTRY -->
      <div class="card" id="screenEntry">
        <div class="row">
          <input
            id="tableId"
            placeholder="Table ID (ж: table-1)"
            autocomplete="off"
          />
          <input id="name" placeholder="Таны нэр" autocomplete="off" />
        </div>
        <div class="row" style="margin-top: 10px">
          <button id="createBtn" class="btn-blue" style="flex: 1 1 200px">
            Table үүсгэх (Host)
          </button>
          <button id="joinBtn" style="flex: 1 1 120px">Орох</button>
        </div>
        <div class="muted" style="margin-top: 10px">
          Нэг нь Table үүсгэнэ. Бусад нь ижил Table ID-гаар орно.
        </div>
        <div id="entryErr" class="error hide"></div>
      </div>

      <!-- LOBBY -->
      <div class="card hide" id="screenLobby">
        <div class="row">
          <button id="readyBtn" class="btn-green" style="flex: 1 1 120px">
            Ready
          </button>
          <button id="lobbySettleBtn" class="btn-blue" style="flex: 1 1 140px">
            Settlement
          </button>
          <button id="leaveBtn" style="flex: 1 1 90px">Гарах</button>
        </div>

        <div class="divider"></div>

        <div class="row" style="justify-content: space-between">
          <div class="muted">Бүгд Ready → Host Start.</div>
          <button id="startBtn" class="btn-yellow hide" style="flex: 0 0 auto">
            Start
          </button>
        </div>

        <div class="divider"></div>
        <div class="seatList" id="lobbySeats"></div>

        <div id="lobbyErr" class="error hide"></div>
      </div>

      <!-- GAME -->
      <div class="card hide" id="screenGame">
        <div class="tableWrap">
          <div class="felt"></div>

          <div class="centerInfo">
            <div class="pot" id="potText">Current: 0</div>
            <div class="meta" id="handMeta"></div>
          </div>

          <div id="seatLayer"></div>
        </div>

        <div id="turnBanner" class="turnBanner hide"></div>
        <div id="gameErr" class="error hide"></div>

        <!-- Optional (below) -->
        <details>
          <summary>Ledger / History</summary>
          <div class="detailsBody">
            <div class="divider"></div>
            <div style="font-weight: 950">Ledger</div>
            <div class="muted">+ авах, − төлөх (нийт)</div>
            <div class="divider"></div>
            <div id="ledgerList"></div>

            <div class="divider"></div>
            <div style="font-weight: 950">History</div>
            <div
              id="history"
              class="muted"
              style="margin-top: 8px; font-size: 12px"
            ></div>

            <div class="divider"></div>
            <button id="settleBtn" class="btn-blue" style="width: 100%">
              Settlement
            </button>

            <div class="divider"></div>
            <button id="backToLobbyBtn" style="width: 100%">
              Lobby руу буцах
            </button>
          </div>
        </details>
      </div>
    </div>

    <!-- Bottom action bar (game only) -->
    <div class="bottomBar hide" id="bottomBar">
      <div class="bottomInner">
        <div id="actionStatus" class="pill" style="width: fit-content">
          Waiting…
        </div>

        <div class="actionRow">
          <button class="btn-green" id="btnCall">Call</button>
          <button class="btn-yellow" id="btnRaise">Raise</button>
          <button class="btn-red" id="btnFold">Fold</button>
        </div>

        <div class="raiseRow">
          <input
            id="raiseInput"
            inputmode="numeric"
            placeholder="Raise to (ж: 1,000)"
          />
          <button id="btnWin" class="btn-blue hide">Winner</button>
        </div>

        <div class="quickRow">
          <button id="q500" class="btn-yellow">500</button>
          <button id="q1000" class="btn-yellow">1,000</button>
          <button id="q1500" class="btn-yellow">1,500</button>
          <button id="q2000" class="btn-yellow">2,000</button>
        </div>
      </div>
    </div>

    <script src="./config.js"></script>
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
    <script src="./app.js"></script>
  </body>
</html>
